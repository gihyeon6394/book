# 9. 클라우드 아키텍처

1. 클라우드 아키텍처
2. 리소스 풀링
3. 로드 밸런싱
4. 오토 스케일링
5. 클라우드 버스팅
6. 무중단 서비스 재배치

---

## 1. 클라우드 아키텍처

#### 서비스 오케스트레이션

- 프로비저닝 자동화
- 리소스 배치 자동화를 위한 설정, 관리, 조정 작업

#### 클라우드 서비스 관리

- 경영지원 : 리소스 과금, 감사
- 프로비저닝 / 구성 : 리소스 배치, 변경, 모니터링, SLA (Service Level Agreement) 관리
- 이식성 / 상호 운용성
    - 타 시스템으로 데이터, 소프트웨어 마이그레이션
    - 2개 이상의 시스템 간의 통신

#### 고가용성 (HA, High Availability)

- 서버, 네트워크, 프로그램 등이 오랜 시간동안 지속적으로 정상 운영이 가능한 것
- 5nines(99.999%) : 1년에 5분 이하의 다운타임
- 확보 방안
    - 어플리케이션 서버 다중화, 부하 분산
    - 데이터베이스, 스토리지 이중화
    - 여러 지리적 위치에 서비스 배치

### 클라우드 아키테쳐링 (Architecture)

- 클라우드 기반 정보 서비스 설계시 오케스트레이션, 클라우드 서비스를 고려
- 서비스 대상, 리스크 분석, 컴퓨팅 리소스 배치, 설계
- 주요 목적 : 급작스러운 트래픽에 대한 대응 자동화, 고가용성 확보
- 리소스 풀링 (Resource Pooling)
- 로드 밸런싱 (Load Balancing)
- 오토 스케일링 (Auto Scaling)
- 클라우드 버스팅 (Cloud Bursting)

## 2. 리소스 풀링

- 사용자 요청 발생 시 리소스 풀 (pool)로부터 리소스를 사용하고 반환하는 과정
- 리소스 풀 : 하드웨어 장비 pool e.g. CPU 풀, 네트워크 풀, 메모리 풀, ...
    - 즉시 사용가능한 서버, 스토리지 등을 담아두는 공간
    - 사용자로부터 지리적 위치가 가까운 곳에 구성

### 특징

- 물리적 위치 알 수 없음
    - IDC 특정 위치, 스토리지 내부 위치 등
- 추상화
- 서비스나 프로그램에 의해 자유롭게 사용, 해제
- 구성 : 도시, 국가 단위로 계층적으로 구조
    - 사용자 요청시 계층적으로 접근해 즉시 리소스 제공
- 리소스를 사용한 만큼 비용 지불

## 3. 로드 밸런싱 (Load Balancing)

- load : 서버에게 요청을 처리하도록 부과하는 것
- load balancing : 사용자 요청을 여러대의 서버로 분산하는 방법
- 서버의 용량과 성능을 확장 / 축소
    - scaling up : 서버의 성능을 향상 (수직 확장)
    - scaling out : 서버의 대수를 늘림 (일반적 방법, 수평 확장)

### scale up vs scale out

| scale up                        |       | scale out (클라우드에서 사용되는 일반적인 방법)          |
|---------------------------------|-------|------------------------------------------|
| 리소스를 추가해서 하드웨어 장비 성능 높임, 한계가 있음 | 구성    | 하나의 장비에서 처리하던 일을 여러 대의 장비에서 처리, 지속 확장 가능 |
| 비용증가 폭이 큼                       | 비용    | 상대적 저렴                                   |
| 장애 전파 가능성                       | 장애 전파 | 읽기/쓰기가 여러 대에 분산되어 처리, 장애 전파 가능성 낮음       |

### 로드밸런서 역할 (L4 switch)

- 로드밸런서가 여러대에 요청을 분배
- 요청이 집중되지 않게 함

## 4. 오토 스케일링 (Auto Scaling)

- 사용자 증가/감소에 따라 스케일링을 통해 유동적으로 리소스 변화 필요
    - scale out 자동화
    - 리소스 풀링 + 로드밸런싱
- 요구 기술
    - 클라우드 사용량 모니터
        - 임계값 설정, 수행작업 지정
    - 자동 확장 리스너
        - 모니터링 중 이벤트 전달
        - 리소스 풀에서 리소스 사용후 반납

#### 자동확장 리스너 예시

- CPU 90% 이상 사용시
    - 가상서버 1대 추가, 로드밸런서에 연결
- CPU 30% 이하 사용시
    - 가상서버 1대 제거(반납), 로드밸런서에서 제외

## 5. 클라우드 버스팅 (Cloud Bursting)

- private cloud에서 사용
- 시스템의 처리량을 넘어서면 private cloud에서 public cloud로 확장해서 일시적으로 처리
    - private cloud와 동일한 환경의 public cloud 구성
    - 임계값, 버스팅 조건, 이관 대상 데이터, application 지정
    - 이벤트 발생 시private cloud에서 public cloud로 이관

### Burst-out, Burst-in

- Burst-out : private cloud에서 public cloud로 확장
- Burst-in : public cloud에서 private cloud로 축소

## 6. 무중단 서비스 재배치

- 24/365 정책 요구 (포털, 금융 서비스 등)
- 불가피한 시스템 중단
    - 클라우드 서버 처리량 초과
    - 일시적인 다운타임 (시스템 업그레이드, 보안 패치 등)
    - 신규 물리서버로 마이그레이션
- 무중단 서비스 재배치로 다운타임 최소화

### on-premise 환경에서의 무중단 서비스 재배치

- 이중화 서버 구조 구축
    - active-active : 모든 서버가 동시에 운영
    - active-standby : 대기 서버가 있어서 장애 발생시 대기 서버로 전환
        - hot, warm, cold standby
        - cold standby : 서버가 꺼져있어서 즉시 사용 불가
        - warm standby : 서버는 켜져있지만 서비스는 중지
        - hot standby : 서버가 켜져있고 서비스도 운영중

### 클라우드 환경에서의 무중단 서비스 재배치

- 가상서버 생성 후 동작 중인 서버 복제
- active-active 이중화 제공

#### 동작 : 다운타임 이벤트 발생 시

1. 가상화 인프라 관리자가 새로운 물리서버의 하이퍼바이저에게 VM 생성 요청
2. VM 생성 완료 후 기존 VM을 복제 (OS, Application, Data)

#### 동작 : 가상 디스크 이관

- 가상 서버 디스크가 로컬 스토리지인 경우
- 가상 서버 디스크를 원격 공유 스토리지인 경우
- 로컬 스토리지 : OS, application 에서 접근하는 core 데이터, 데이터베이스 파일
- 공유 스토리지 : 그 외