# 2. Computer-System Organization

1. Interrupts
    1. Overview
    2. Implementation
2. Storage Structure
3. I/O Structure

---

<img src="img.png"  width="40%"/>

#### device controller <sup>장치 제어기</sup>

- 하나의 컴퓨터 시스템, 여러 개의 장치 제어기와 디바이스 <sup>컴포넌트</sup>
- Bus 를 통해 연결
    - Bus : 공유 메모리와 컴포넌트 연결
- 각 장치 제어기는 특정 유형의 디바이스 장치를 담당
    - ex.
        - disk controller : disks
        - USB controller : USB devices
        - graphics adapter : monitor
- 장치 제어기에 따라 여러개의 컴포넌트 연결 가능
    - ex. USB port는 USB hub를 통해 여러 장치와 연결
- 장치 제어기는 일부 로컬 버퍼 저장소와 특수 목적의 레지스터 세트를 유지
- 장치 제어기 주변 장치와 로컬 버퍼 저장소 간의 데이터 이동 책임

#### device driver <sup>장치 드라이버</sup>

- 일반적으로 각 장치 제어기 마다 존재
- 장치 제어기를 이해하고, OS 에게 장치에 대한 적절한 인터페이스 제공
- CPU와 장치 제어기는 병렬로 실행 가능 <sub>메모리 사이클에서 경쟁</sub>
- 공유 메모리에 접근 순서를 올바르게 하기 위해, memory controller 는 메모리의 접근을 동기화

#### 시스템의 3가지 지점

- Interrupt
- storage structure
- I/O structure

---

## 2.1 Interrupts

#### 전형적인 컴퓨터 명령 예시 : 키보드 타이핑

1. 키보드를 누름
2. 장치 드라이버는 장치 제어기에 적절한 레지스터들을 로드
3. 장치 제어기가 레지스터의 내용을 검사하여 수행할 작업 결정
    - ex. 키보드 장치를 통해 문자를 읽어라.
4. 장치 제어기가 문자를 디바이스에서 로컬 버퍼로 전송
5. 전송이 끝나면 장치 드라이버에게 명령 <sup>입력</sup>이 끝났음을 알림
6. 장치 드라이버는 제어를 다른 OS 일부에게 넘김
    - 동시에, 디바이스 드라이버가 메시지 전송 가능 "입력이 성공적으로 완료"

---

어떻게 장치 제어기가 장치 드라이버에게 명령이 끝났음을 알릴까?  
**interrupt**를 통해 가능하다

### 2.1.1 Overview

<img src="img_1.png"  width="50%"/>

- 하드웨어는 일반적을 시스템 버스를 통해 CPU 에게 신호를 보냄으로서 인터럽트 트리거
    - 시스템 버스는 주요 컴포넌트 간의 메인 커뮤니케이션 채널
- 인터럽트는 많은 목적을 가지지만,
- OS와 하드웨어가 상호작용할 수 있는 방법을 제공하는게 주요 기능

#### CPU가 인터럽트 되면,

- 하던 일을 멈추고,
- 즉시 고정된 위치로 실행을 전송함
- 고정된 위치는 인터럽트가 위치한 서비스 루틴의 시작 주소를 가짐

#### 인터럽트는 컴퓨터 아키텍쳐의 중요 부분

- 컴퓨터 디자인마다 고유 인터럽트 매커니즘을 가지지만, 몇가지 기능은 공통임
- 인터럽트는 반드시 적절한 인터럽트 서비스 루틴에게 제어를 전송해야 함
    - 단순한 방법은 제너릭 루틴을 호출하여 인터럽트 정보를 검사하는 것
    - 그 다음 루틴은 인터럽트 핸들러를 호출함
- 인터럽트는 자주 발생하기 때문에 빠르게 처리되어야 함
    - 인터럽트 루틴을 가리키는 포인터 테이블이 빠른 속도 제공 가능
    - 테이블을 통해 인터럽트 루틴이 간접적으로 호출됨
    - 포인터 테이블은 로우 메모리에 저장
    - interrupt vector <sup>인터럽트 벡터</sup>라고도 함

#### 인터럽트 아키텍쳐는 어떤것이 언터럽트 되었건 상태정보를 저장

- 인터럽트 제공 후 다시 복귀할 수 있도록
- 인터럽트 루틴이 프로세서의 상태를 변경해야 한다면,
    - 즉시 최신상태를 저장하고 복귀 전 복원
- 인터럽트가 서비스된 후 저장된 주소값이 프로그램 카운터에 로드
    - 인터럽트된 연산은 인터럽트가 없었던 것처럼 계속됨

### 2.1.2 Implementation

<img src="img_2.png"  width="50%"/>

#### 인터럽트 메커니즘

1. CPU 가 interrupt-request line을 가짐
    - interrupt-request line : CPU가 모든 명령 종료를 감지
2. 장치 제어기가 interrupt-request line을 통해 CPU에게 인터럽트를 요청

## 2.2 Storage Structure

## 2.3 I/O Structure
