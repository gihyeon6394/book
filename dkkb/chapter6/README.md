# 실전에 활용 가능한 컨테이너 사용법을 익히자

- 실전내용
- 볼륨과 마운트, 바인드 마운트

## 1. 내게 필요한 지식이 무엇인지 정리하기

### 자신의 역할에 따라 알아야할 지식이 달라진다

- 도커를 깊이 공부해야함 : 이미지를 생성자, 서버 / 보안 엔지니어
- 도커를 얕게 공부해야함 : 이미지 사용자, 개발자, 디자이너, PM 등

### 앞으로 설명할 도커 기술

#### 모두 익혀야하는 기술은 **굵게 표시**

- **파일 복사** <sup>호스트<->컨테이너</sup>
- 볼륨 마운트
    - **바인드 마운트** : 컨테이너와 파일 연동, LAMP 스택 필수
    - 볼륨 마운트 : 운영체제와 무관하게 똑같은 방식으로 파일 다루기 가능
- **컨테이너를 이미지로 만들기** : 컨테이너를 다른 서버로 복사하고싶거나 여러개가 필요할 때
    - 서버 엔지니어, 유지보수 담당자
- **컨테이너 개조** : 서버 준비하는 사람에게 필수
    - 사내 시스템을 컨테이너로 전환하게 되었다? **(필수)**
- 도커 허브 로그인 : 자신이 만든 이미지를 공개
- 도커 컴포즈 : 데이터베이스, 애플리케이션 컨테이너를 함께 시작하고 싶거나 환경을 대량 생상하려할 떄
- 쿠버네티스 : 여러대의 서버에서 컨테이너를 실행할 때 사용하는 컨테이너 오케스트레이션 도구
    - **대규모 시스템 운영**이아니라면 거의 사용할 일 없음

## 2. 컨테이너와 호스트 간에 파일 복사하기

- 파일복사는 호스트 <-> 컨테이너 양방향 가능

### 파일 복사

~~~~
## 파일 복사
docker cp [원본 경로] [대상 경로]

## 호스트 -> 컨테이너
docker cp [호스트의 파일] [컨테이너명]:[컨테이너 경로]

## 컨테이너 -> 호스트
docker cp [컨테이너명]:[컨테이너 경로] [호스트 경로]
~~~~

### [실습] 호스트의 파일을 컨테이너 속으로 복사

1. 아파치 컨테이너 생성 and 실행
2. **호스트의 파일을 컨테이너 속으로 복사**
3. 확인

### [실습] 컨테이너의 파일을 호스트로 복사

1. 아파치 컨테이너 생성 and 실행
2. **컨테이너의 파일을 호스트로 복사**
3. 확인

## 3. 볼륨과 마운트

### 볼륨과 마운트

- **data persistency** : 컨테이너가 사용하는 데이터를 컨테이너 외부 <sup>스코리지, 볼륨, 메모리 등</sup>에 두고 사용함
- volume : 스토리지를 분할한 뒤 한 영역
- **mount** : 컨테이너가 외부 데이터를 사용할 수 있도록 연결하는 행위
  - 관례적으로 **'볼륨 마운트'**라고 함

### 스토리지 마운트의 종류

#### 볼륨 마운트

- 임시 파일, 자주쓰지 않지만 지우면 안되는 파일
- **도커 엔진이 관리하는 영역 내**의 볼륨에 마운트

#### 바인드 마운트

- 자주 사용하는 파일
- 도커 엔진 외부의 OS 단 디렉터리에 마운트

#### 볼륨 마운트 vs 바인드 마운트

- 간단한가 복잡한가?
- 호스트 컴퓨터에서 파일을 다룰 것인가?
- 환경의 의존성을 배제해야하는가?

- 볼륨 마운트 <sup>**docker 제작사 권장**</sup>
  - 장점 : 익숙해지면 손쉽게 사용, 운영체제에 의존적이지 않음
  - 단점 : 도커를 경유해서 파일에 접근해야 함, 파일 백업 절차 복잡
- 바인드 마운트
  - 장점 : 기존과 동일한 방식으로 파일 사용 가능, 파일 자주 접근 시 용이

#### 결론 : 파일을 직접 편집할 일이 많으면 바인드 마운트 아니면 볼륨 마운트

### 스토리지 영역을 마운트하는 커맨드

~~~~
## 바인드 마운트
docker run -v [호스트의 디렉터리]:[컨테이너의 디렉터리]

## 볼륨 마운트
docker run -v [볼륨명]:[컨테이너의 디렉터리]
~~~~

#### 스토리지 마운트 절차

1. 스토리지 영역 생성 **(마운트 전에 볼륨을 생성하는 것이 좋음)**
   - 볼륨 마운트라면 마운트와 동시에 볼륨을 생성할 수 있지만 **비추**
2. 컨테이너 생성 and 마운트


### [실습] 바인드 마운트해보기

1. 바인드 마운트할 디렉터리 생성 : 폴더 생성
2. 아파치 컨테이너 생성
3. 초기화면 확인
4. index.html 배치
5. 배치 확인

### [실습] 응용편 = 볼륨 마운트해보기

## 4. 컨테이너로 이미지 만들기

### 컨테이너로 이미지를 만드는 방법

### [실습] commit 커맨드로 컨테이너를 이미지로 변환

### [실습] Dockerfile 스크립트로 이미지 만들기

## 5. 컨테이너 개조

### 컨테이너의 개조란?

### 도커의 구조, 도커 엔진을 통해야 하는 명령과 컨테이너 안에서 실행해야하는 명령

## 6. 도커 허브 등록 및 로그인

### 이미지는 어디서 내려받는 걸까?

### 도터 허브와 도커 레지스트리

### 태그와 이미지 업로드

### 레지스트리를 만드는 방법
